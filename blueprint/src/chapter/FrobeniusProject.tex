\chapter{A project: Frobenius elements}

\section{Introduction and goal}

I had thought that the existence of Frobenius elements was specific to the theory
of local and global fields, until Joel Riou pointed out
an extremely general result from from Bourbaki's Commutative Algebra
(Chapter V, Section 2, number 2, theorem 2, part (ii)). This beautiful
result is surely what we want to see in mathlib. Before we state Bourbaki's
theorem, let us set the scene.

\section{Statement of the theorem}

The set-up throughout this project:
$G$ is a finite group acting (via ring isomorphisms) on a commutative ring $B$,
and $A$ is the subring of $G$-invariants.

$Q$ is be a prime ideal of $B$, whose pullback to $A$ is the prime ideal $P$.
Note that $G$ naturally acts on the ideals of $B$. Let's define the
\emph{decomposition group} $D_Q$ of $Q$ to be the subgroup of $G$ which
stabilizes $Q$.

Let $L$ be the field of fractions of the integral domain $B/Q$, and let $K$ be the
field of fractions of the subring $A/P$. Then $L$ is naturally a $K$-algebra.
In this generality $L/K$ may not even be Galois, but we can still talk about
$\Aut_K(L)$.

In the next definition we write down a group homomorphism from $D_Q$ to $\Aut_K(L)$.

\begin{definition}
  \label{Pointwise.stabilizer.toGaloisGroup}
  \lean{Pointwise.stabilizer.toGaloisGroup}
  Choose $g\in D_Q$. Then the action of $g$ on $B$ gives us an induced
  $A/P$-algebra autoomorphism of $B/Q$ which extends to a $K$-algebra automorphism $\phi_g$ of $L$.
  This construction $g\mapsto \phi_g$ defines a group homomorphism from $D_Q$
  to $\Aut_K(L)$.
  \leanok
\end{definition}

The theorem we want in this project is
\begin{theorem}
  \label{MulAction.stabilizer_surjective_of_action}
  \lean{MulAction.stabilizer_surjective_of_action}
  \uses{Pointwise.stabilizer.toGaloisGroup}
  The map $g\mapsto \phi_g$ from $D_Q$ to $\Aut_K(L)$ defined above is surjective.
\end{theorem}

The goal of this project is to get this theorem into mathlib.

In particular, $\Aut_K(L)$ is finite, although we prove this along the way and not
as a corollary. What is so striking about this theorem to me is that the only finiteness hypothesis
is on the group $G$ which acts; there are no finiteness hypotheses on the rings at all.

As a trivial consequence we get Frobenius elements for finite Galois extensions in bothe
the local and global field setting, as $\Aut_K(L)$ is just a Galois group of finite fields
in these cases, so by surjectivity we can lift a Frobenius element.

Even though $G$ is finite, it is possible in this generality for the extension $L/K$ to be infinite!
An example in the exercises in Bourbaki (exercise 9 of number 2 above):
$B=\mathbb{F}_2[X_0,X_1,X_2,\ldots]$
is a polynomial ring in infinitely many variables and $G$ is cyclic of order 2 with
the generator acting on $B$ via $X_{2n}\mapsto X_{2n}+X_{2n+1}$ and $X_{2n+1}\mapsto X_{2n+1}$.
If $Q$ is the ideal generated by the $X_{2n+1}$ then apparently $L/K$ is a radical extension of
infinite degree. What is true however is that $\Aut_K(L)$ is always finite. Indeed we shall
see that $L/K$ is normal, and its maximal separable subextension is finite of degree
at most $|G|$.

\section{The extension $B/A$.}

The precise set-up we'll work in is the following. We fix $G$ a finite group acting
on $B$ a commutative ring, and we have another commutative ring $A$ such
that $B$ is an $A$-algebra and the image of $A$ in $B$ is precisely the $G$-invariant
elements of $B$. We don't need the map $A\to B$ to be injective so we don't assume this.

We start with a fundamental construction.

\begin{definition}
  \lean{MulSemiringAction.CharacteristicPolynomial.F}
  \label{MulSemiringAction.CharacteristicPolynomial.F}
  \leanok
  If $b\in B$ then define the \emph{characteristic polynomial}
  $F_b$ of $b$ to be $\prod_{g\in G}(X-g\cdot b)$.
\end{definition}

Clearly $F_b$ is a monic polynomial of degree $|G|$. Note also
that $F_b$ is $G$-invariant, because acting by some $a\in G$
just permutes the order of the factors. Hence we can descend $F_b$
to a monic polynomial $M_b$ of degree $|G|$ in $A[X]$. We will
also call it the characteristic polynomial of $b$, even though
it's not even well-defined if the map $A\to B$ isn't injective.

\begin{definition}
  \lean{MulSemiringAction.CharacteristicPolynomial.M}
  \label{MulSemiringAction.CharacteristicPolynomial.M}
  \leanok
  $M_b$ is any monic degree $|G|$ polynomial in $A[X]$ whose
  image in $B[X]$ is $F_b$.
\end{definition}

\begin{lemma}
  $M_b$ has $b$ as a root.
\end{lemma}
\begin{proof} Exercise.
\end{proof}
\begin{lemma}
  $M_b$ has degree $n$.
\end{lemma}
\begin{proof} Exercise.
\end{proof}
\begin{lemma} $M_b$ is monic.
\end{lemma}
\begin{proof}
  Exercise.
\end{proof}
\begin{lemma} $M_b$ splits completely in $B$
\end{lemma}
\begin{proof} Exercise.
\end{proof}

\begin{theorem} $B/A$ is integral.
\end{theorem}
\begin{proof} Use $M_b$.
\end{proof}

\section{The extension $(B/Q)/(A/P)$.}

\begin{theorem}
  \label{dunno}
  If $\beta\in B/Q$ then there's a monic polynomial of degree $|G|$ in $A/P[X]$
  which has $\beta$ as a root. This polynomial splits completely in $B/Q[X]$.
\end{theorem}
\begin{proof}
  Use the image of $M_b$ where $b$ lifts $\beta$.
\end{proof}

\begin{corollary}
  \uses{dunno}
  If $\beta\in B/Q$ is nonzero then there's some nonzero $\alpha\in A/P$
  such that $\beta$ divides the image of $\alpha$ in $B/Q$.
\end{corollary}
\begin{proof} Consider the monic polynomial $f(X)$ with $\beta$ as a root, whose
  existence was shown in the previous theorem, and write $n=|G|$, so $f$ is monic
  of degree $n$. We cannot have $f(X)=X^n$ as this would imply that $\beta$ is
  nilpotent and hence zero, as $B/Q$ is an integral domain. Hence $f(X)=X^n+\cdots +\alpha X^d$
  for some $d<n$ and nonzero $\alpha\in A$. Again using the fact that $B/Q$ is an integral domain, we
  deduce that $\beta$ must a be root of $f/X^d=X^{n-d}+\cdots+\alpha=X(\cdots)+\alpha$, and setting
  $X=\beta$ shows that $\beta$ divides $\alpha$.
\end{proof}

\section{The extension $L/K$.}

\begin{theorem}
If $\lambda\in L$ then there's a monic polynomial $P_\lambda\in K[X]$ of degree $n$
with $\lambda$ as a root, and which splits completely in $L[X]$.
\end{theorem}
\begin{proof}
  A general $\lambda\in L$ can be written as $\beta_1/\beta_2$ where $\beta_1,\beta_2\in B/Q$.
  The previous corollary showed that there's some nonzero $\alpha\in A/P$ such that $\beta_2$
  divides $\alpha$, and hence $\alpha\lambda\in B/Q$ (we just cleared denominators).
  Thus $\alpha\lambda$ is a root of some monic polynomial $f(x)\in A[X]$,
  by a previous result with no label. The polynomial $f(\alpha x)\in A[X]$ thus
  has $\lambda$ as a root, but it is not monic; its leading term is $\alpha^n$.
  Dividing through in $K[X]$ gives us the polynomial we seek.
\end{proof}

\begin{corollary} The extension $L/K$ is algebraic and normal.
\end{corollary}
\begin{proof} Exercise using the previous theorem.
\end{proof}

Note that $L/K$ might not be separable and might have infinite degree. However

\begin{corollary} Any subextension of $L/K$ which is finite and separable over $K$
  has degree at most $|G|$.
\end{corollary}
\begin{proof}
  Finite and separable implies simple, and now use an earlier result.
\end{proof}

\begin{corollary} The maximal separable subextension $M$ of $L/K$ has degree at most $|G|$.
\end{corollary}
\begin{proof} If it has dimension greater than $|G|$ over $K$, then it has a finitely-generated
  subfeld of $K$-dimension greater than $|G|$, and is finite and separable, contradicting
  the previous result.
\end{proof}

\begin{corollary} $\Aut_K(L)$ is finite.
\end{corollary}
\begin{proof} Any $K$-automorphism of $L$ is determined by where it sends $M$.
\end{proof}

\begin{corollary} $\Aut_{A/P}(B/Q)$ is finite.
\end{corollary}
\begin{proof}
  Two elements of $\Aut_{A/P}(B/Q)$ which agree once extended to automorphisms of $L$
  must have already been equal, as $B/Q\subseteq L$. Hence the canonical map
  from $\Aut_{A/P}(B/Q)$ to $\Aut_K(L)$ is injective.
\end{proof}

\section{Proof of surjectivity.}

\begin{definition} We fix once and for all some nonzero $y\in B/Q$ such that $M=K(y)$,
  with $M$ the maximal separable subextension of $L/K$.
\end{definition}

Note that the existence of some $\lambda\in L$ with this property just comes from finite
and separable implies simple; we can use the ``clear denominator'' technique introduced
earlier to scale this by some nonzero $\alpha\in A$ into $B/Q$, as
$K(\lambda)=K(\alpha\lambda)$.

We now choose some $x\in B[1/S]$ which is $y$ modulo $Q$ and $0$ modulo all the other
primes of $B$ above $P$, and consider the monic degree $|G|$ polynomial $f$ in $K[X]$
with $x$ and its conjugates as roots. If $\sigma\in\Aut_K(L)$ then $\sigma(\overline{x})$
is a root of $f$ as $\sigma$ fixes $K$ pointwise. Hence $\sigma(\overline{x})=\overline{g(x)}$
for some $g\in G$, and because $\sigma(\overline{x})\not=0$ we have $\overline{g(x)}\not=0$
and hence $g(x)\notin Q[1/S]$. Hence $x\notin g^{-1} Q[1/S]$ and thus $g^{-1}Q=Q$ and $g\in SD_Q$.
Finally we have $\phi_g=\sigma$ on $K$ and on $y$, so they are equal on $M$ and hence on $L$ as
$L/M$ is purely inseparable.

This part of the argument seems weak.
